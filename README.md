# è¯•å·å›¾åƒåˆ†å‰²ç³»ç»Ÿ

åŸºäºYOLOv8mçš„è¯•å·é¢˜ç›®æ£€æµ‹ä¸åˆ†å‰²ç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«è¯•å·ä¸­çš„é¢˜ç›®åŒºåŸŸå¹¶è¿›è¡Œç²¾ç¡®åˆ†å‰²ã€‚

## é¡¹ç›®ç‰¹ç‚¹

- ğŸ¯ **é«˜ç²¾åº¦æ£€æµ‹**: åŸºäºYOLOv8mæ¨¡å‹ï¼Œæ£€æµ‹ç²¾åº¦é«˜
- ğŸš€ **å¿«é€Ÿå¤„ç†**: æ”¯æŒGPUåŠ é€Ÿï¼Œå¤„ç†é€Ÿåº¦å¿«
- ğŸ“Š **å®Œæ•´æµç¨‹**: ä»æ•°æ®é¢„å¤„ç†åˆ°æ¨¡å‹è®­ç»ƒå†åˆ°å›¾åƒåˆ†å‰²çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ
- ğŸ”§ **æ˜“äºä½¿ç”¨**: æä¾›ç®€å•æ˜“ç”¨çš„å‘½ä»¤è¡Œæ¥å£
- ğŸ“ˆ **å¯è§†åŒ–ç»“æœ**: æ”¯æŒæ£€æµ‹ç»“æœå¯è§†åŒ–å’Œè¯¦ç»†æŠ¥å‘Šç”Ÿæˆ
- ğŸ”„ **æ‰¹é‡å¤„ç†**: æ”¯æŒå•å¼ å›¾ç‰‡å’Œæ‰¹é‡å›¾ç‰‡å¤„ç†

## é¡¹ç›®ç»“æ„

```
quesitionSeg/
â”œâ”€â”€ configs/                 # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ dataset.yaml         # æ•°æ®é›†é…ç½®
â”‚   â””â”€â”€ train_config.yaml    # è®­ç»ƒé…ç½®
â”œâ”€â”€ scripts/                 # è„šæœ¬æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ coco_to_yolo.py      # COCOåˆ°YOLOæ ¼å¼è½¬æ¢
â”‚   â”œâ”€â”€ prepare_dataset.py   # æ•°æ®é›†å‡†å¤‡å’ŒéªŒè¯
â”‚   â”œâ”€â”€ train_yolo.py        # æ¨¡å‹è®­ç»ƒè„šæœ¬
â”‚   â””â”€â”€ segment_questions.py # å›¾åƒåˆ†å‰²ä¸»ç¨‹åº
â”œâ”€â”€ datasets/                # æ•°æ®é›†ç›®å½•
â”‚   â”œâ”€â”€ train/               # è®­ç»ƒé›†
â”‚   â”œâ”€â”€ val/                 # éªŒè¯é›†
â”‚   â”œâ”€â”€ test/                # æµ‹è¯•é›†
â”‚   â””â”€â”€ yolo_format/         # YOLOæ ¼å¼æ•°æ®
â”œâ”€â”€ models/                  # æ¨¡å‹æ–‡ä»¶ç›®å½•
â”œâ”€â”€ outputs/                 # è®­ç»ƒè¾“å‡ºç›®å½•
â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ data/                    # åŸå§‹æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ Images/              # åŸå§‹å›¾ç‰‡
â”‚   â””â”€â”€ Annotations/         # COCOæ ‡æ³¨æ–‡ä»¶
â”œâ”€â”€ requirements.txt         # ä¾èµ–åŒ…åˆ—è¡¨
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- CUDA 11.0+ (GPUè®­ç»ƒæ¨è)
- å†…å­˜: 8GB+ (æ¨è16GB+)
- å­˜å‚¨: 10GB+ å¯ç”¨ç©ºé—´

## å®‰è£…æ­¥éª¤

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <é¡¹ç›®åœ°å€>
cd quesitionSeg
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ (æ¨è)

```bash
# ä½¿ç”¨conda
conda create -n yolo_seg python=3.9
conda activate yolo_seg

# æˆ–ä½¿ç”¨venv
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

### 3. å®‰è£…ä¾èµ–åŒ…

```bash
pip install -r requirements.txt
```

### 4. éªŒè¯å®‰è£…

```bash
python -c "from ultralytics import YOLO; print('YOLOv8 å®‰è£…æˆåŠŸ')"
```

## ä½¿ç”¨æŒ‡å—

### ç¬¬ä¸€æ­¥: æ•°æ®å‡†å¤‡

1. **å‡†å¤‡åŸå§‹æ•°æ®**
   - å°†è¯•å·å›¾ç‰‡æ”¾å…¥ `data/Images/` ç›®å½•
   - å°†COCOæ ¼å¼æ ‡æ³¨æ–‡ä»¶æ”¾å…¥ `data/Annotations/` ç›®å½•

2. **è½¬æ¢æ•°æ®æ ¼å¼**
   ```bash
   python scripts/coco_to_yolo.py
   ```

3. **éªŒè¯æ•°æ®é›†**
   ```bash
   python scripts/prepare_dataset.py --validate
   ```

### ç¬¬äºŒæ­¥: æ¨¡å‹è®­ç»ƒ

1. **æ£€æŸ¥é…ç½®æ–‡ä»¶**
   - ç¼–è¾‘ `configs/train_config.yaml` è°ƒæ•´è®­ç»ƒå‚æ•°
   - ç¼–è¾‘ `configs/dataset.yaml` ç¡®è®¤æ•°æ®è·¯å¾„

2. **å¼€å§‹è®­ç»ƒ**
   ```bash
   python scripts/train_yolo.py
   ```

3. **ç›‘æ§è®­ç»ƒè¿‡ç¨‹**
   - æŸ¥çœ‹ `logs/` ç›®å½•ä¸­çš„æ—¥å¿—æ–‡ä»¶
   - æŸ¥çœ‹ `outputs/` ç›®å½•ä¸­çš„è®­ç»ƒç»“æœ

4. **ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒ**
   ```bash
   python scripts/train_yolo.py --resume outputs/yolov8m_question_detection/weights/last.pt
   ```

### ç¬¬ä¸‰æ­¥: å›¾åƒåˆ†å‰²

1. **å•å¼ å›¾ç‰‡åˆ†å‰²**
   ```bash
   python scripts/segment_questions.py \
     --model outputs/yolov8m_question_detection/weights/best.pt \
     --input test_image.jpg \
     --output results/
   ```

2. **æ‰¹é‡å›¾ç‰‡åˆ†å‰²**
   ```bash
   python scripts/segment_questions.py \
     --model outputs/yolov8m_question_detection/weights/best.pt \
     --input test_images/ \
     --output results/ \
     --batch
   ```

3. **è‡ªå®šä¹‰å‚æ•°**
   ```bash
   python scripts/segment_questions.py \
     --model outputs/yolov8m_question_detection/weights/best.pt \
     --input test_image.jpg \
     --output results/ \
     --conf 0.6 \
     --iou 0.5 \
     --min-area 2000
   ```

## é…ç½®è¯´æ˜

### è®­ç»ƒé…ç½® (train_config.yaml)

```yaml
training:
  epochs: 100          # è®­ç»ƒè½®æ•°
  batch_size: 16       # æ‰¹æ¬¡å¤§å°
  imgsz: 640          # è¾“å…¥å›¾åƒå°ºå¯¸
  device: 'auto'      # è®¾å¤‡é€‰æ‹© ('auto', 'cpu', '0', '0,1')
  workers: 8          # æ•°æ®åŠ è½½çº¿ç¨‹æ•°
  patience: 20        # æ—©åœè€å¿ƒå€¼

optimizer:
  lr0: 0.01           # åˆå§‹å­¦ä¹ ç‡
  momentum: 0.937     # åŠ¨é‡
  weight_decay: 0.0005 # æƒé‡è¡°å‡

augmentation:
  hsv_h: 0.015        # è‰²è°ƒå¢å¼º
  hsv_s: 0.7          # é¥±å’Œåº¦å¢å¼º
  hsv_v: 0.4          # æ˜åº¦å¢å¼º
  degrees: 0.0        # æ—‹è½¬è§’åº¦
  translate: 0.1      # å¹³ç§»æ¯”ä¾‹
  scale: 0.5          # ç¼©æ”¾æ¯”ä¾‹
  fliplr: 0.5         # æ°´å¹³ç¿»è½¬æ¦‚ç‡
```

### æ•°æ®é›†é…ç½® (dataset.yaml)

```yaml
path: datasets/yolo_format  # æ•°æ®é›†æ ¹ç›®å½•
train: train/images         # è®­ç»ƒé›†å›¾ç‰‡è·¯å¾„
val: val/images            # éªŒè¯é›†å›¾ç‰‡è·¯å¾„
test: test/images          # æµ‹è¯•é›†å›¾ç‰‡è·¯å¾„

nc: 1                      # ç±»åˆ«æ•°é‡
names:
  0: question              # ç±»åˆ«åç§°
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç¡¬ä»¶ä¼˜åŒ–
- **GPU**: ä½¿ç”¨NVIDIA GPUå¯æ˜¾è‘—æå‡è®­ç»ƒå’Œæ¨ç†é€Ÿåº¦
- **å†…å­˜**: å¢åŠ ç³»ç»Ÿå†…å­˜å¯æé«˜æ•°æ®åŠ è½½é€Ÿåº¦
- **å­˜å‚¨**: ä½¿ç”¨SSDå¯åŠ å¿«æ•°æ®è¯»å–é€Ÿåº¦

### è½¯ä»¶ä¼˜åŒ–
- **æ‰¹æ¬¡å¤§å°**: æ ¹æ®GPUå†…å­˜è°ƒæ•´batch_size
- **å›¾åƒå°ºå¯¸**: è¾ƒå°çš„imgszå¯æé«˜é€Ÿåº¦ä½†å¯èƒ½é™ä½ç²¾åº¦
- **å·¥ä½œçº¿ç¨‹**: è°ƒæ•´workersæ•°é‡ä»¥å¹³è¡¡CPUå’ŒI/Oè´Ÿè½½

### æ¨¡å‹ä¼˜åŒ–
- **æ¨¡å‹é€‰æ‹©**: æ ¹æ®ç²¾åº¦å’Œé€Ÿåº¦éœ€æ±‚é€‰æ‹©åˆé€‚çš„YOLOæ¨¡å‹
- **é‡åŒ–**: ä½¿ç”¨æ¨¡å‹é‡åŒ–æŠ€æœ¯å‡å°‘æ¨¡å‹å¤§å°
- **å‰ªæ**: ç§»é™¤ä¸é‡è¦çš„æ¨¡å‹å‚æ•°

## å¸¸è§é—®é¢˜

### Q1: è®­ç»ƒæ—¶å‡ºç°CUDAå†…å­˜ä¸è¶³é”™è¯¯
**A**: å‡å°‘batch_sizeæˆ–imgszï¼Œæˆ–è€…ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯:
```yaml
training:
  batch_size: 8  # å‡å°‘æ‰¹æ¬¡å¤§å°
  imgsz: 512     # å‡å°‘å›¾åƒå°ºå¯¸
```

### Q2: æ£€æµ‹ç²¾åº¦ä¸ç†æƒ³
**A**: å°è¯•ä»¥ä¸‹æ–¹æ³•:
- å¢åŠ è®­ç»ƒè½®æ•°
- è°ƒæ•´å­¦ä¹ ç‡
- å¢åŠ æ•°æ®å¢å¼º
- æ£€æŸ¥æ ‡æ³¨è´¨é‡
- ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹(å¦‚yolov8l)

### Q3: æ¨ç†é€Ÿåº¦å¤ªæ…¢
**A**: ä¼˜åŒ–å»ºè®®:
- ä½¿ç”¨è¾ƒå°çš„æ¨¡å‹(å¦‚yolov8n)
- å‡å°‘è¾“å…¥å›¾åƒå°ºå¯¸
- ä½¿ç”¨æ¨¡å‹é‡åŒ–
- å¯ç”¨TensorRTåŠ é€Ÿ

### Q4: æ•°æ®æ ¼å¼è½¬æ¢å¤±è´¥
**A**: æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®:
- COCOæ ‡æ³¨æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
- å›¾ç‰‡è·¯å¾„æ˜¯å¦å­˜åœ¨
- æ–‡ä»¶æƒé™æ˜¯å¦è¶³å¤Ÿ

## è¾“å‡ºç»“æœè¯´æ˜

### è®­ç»ƒè¾“å‡º
- `outputs/yolov8m_question_detection/weights/best.pt`: æœ€ä½³æ¨¡å‹æƒé‡
- `outputs/yolov8m_question_detection/weights/last.pt`: æœ€åä¸€è½®æ¨¡å‹æƒé‡
- `outputs/yolov8m_question_detection/results.png`: è®­ç»ƒæ›²çº¿å›¾
- `outputs/yolov8m_question_detection/confusion_matrix.png`: æ··æ·†çŸ©é˜µ

### åˆ†å‰²è¾“å‡º
- `{image_name}_question_001.jpg`: åˆ†å‰²å‡ºçš„é¢˜ç›®å›¾åƒ
- `{image_name}_annotated.jpg`: æ ‡æ³¨åçš„åŸå›¾
- `{image_name}_results.json`: æ£€æµ‹ç»“æœJSONæ–‡ä»¶
- `segmentation_report.txt`: åˆ†å‰²æŠ¥å‘Š

## æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥:
1. ä¾èµ–åŒ…æ˜¯å¦æ­£ç¡®å®‰è£…
2. é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®è®¾ç½®
3. æ•°æ®æ ¼å¼æ˜¯å¦ç¬¦åˆè¦æ±‚
4. ç³»ç»Ÿèµ„æºæ˜¯å¦å……è¶³

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-XX)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒYOLOv8mæ¨¡å‹è®­ç»ƒ
- æ”¯æŒCOCOåˆ°YOLOæ ¼å¼è½¬æ¢
- æ”¯æŒå›¾åƒåˆ†å‰²å’Œæ‰¹é‡å¤„ç†
- æä¾›å®Œæ•´çš„é…ç½®å’Œä½¿ç”¨æ–‡æ¡£

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ã€‚åœ¨æäº¤ä»£ç å‰ï¼Œè¯·ç¡®ä¿:
1. ä»£ç ç¬¦åˆPEP8è§„èŒƒ
2. æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£
3. é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚